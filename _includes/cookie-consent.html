{% if site.google_analytics_id %}

<div id="cookie-consent-banner" class="cookie-consent-content" role="dialog" aria-labelledby="cookie-consent-title" aria-live="assertive">
  <h2 id="cookie-consent-title" class="visually-hidden">
    Cookie Consent
  </h2>
  <p>This website uses cookies to collect anonymous usage data for analytics. You can accept or declineâ€”it's completely up to you.</p>
  <button id="cookie-consent-accept">Accept</button>
  <button id="cookie-consent-decline">Decline</button>
</div>

<script>
  // Check if user already consented
  const checkConsent = () => {
    const banner = document.getElementById('cookie-consent-banner');
    try {
      if (localStorage.getItem('cookie-consent') === 'accepted') {
        loadGoogleAnalytics(); // If consented earlier, load GA
      } else {
        banner.style.display = 'block'; // Show banner
      }
    } catch (e) {
      console.warn("localStorage not available");
    }
  };

  // Load Google Analytics after consent
  const loadGoogleAnalytics = () => {
    const script = document.createElement('script');
    script.async = true;
    script.src = `https://www.googletagmanager.com/gtag/js?id={{ site.google_analytics_id }}`;
    document.head.appendChild(script);

    script.onload = () => {
      window.dataLayer = window.dataLayer || [];
      const gtag = (...args) => dataLayer.push(...args);
      gtag('js', new Date());
      gtag('config', "{{ site.google_analytics_id }}");
    };
  };

  document.addEventListener('DOMContentLoaded', () => {
    const banner = document.getElementById('cookie-consent-banner');
    if (!banner) return;
    const acceptBtn = document.getElementById('cookie-consent-accept');
    const declineBtn = document.getElementById('cookie-consent-decline');
    // Accept button click event
    if (acceptBtn) {
      acceptBtn.addEventListener('click', () => {
        localStorage.setItem('cookie-consent', 'accepted'); // Store consent
        banner.style.display = 'none'; // Hide banner
        loadGoogleAnalytics(); // Load Google Analytics
      });
    }

    // Decline button click event
    if (declineBtn) {
      declineBtn.addEventListener('click', () => {
        banner.style.display = 'none'; // Hide banner
      });
    }

    // Run consent check
    checkConsent();
  });
</script>

{% endif %}